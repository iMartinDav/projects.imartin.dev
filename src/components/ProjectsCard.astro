---
import { Icon } from "astro-icon/components";
import { getCollection } from "astro:content";
import Card from "./Card/index.astro";

// Fetch and filter posts that are in the 'now' category
const allPosts = await getCollection("posts");
const nowPosts = allPosts.filter((post) => post.data.category === "projects");

// Sort these posts by date in descending order
nowPosts.sort(
	(a, b) =>
		new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime(),
);

// Take the first item from the sorted array as the most recent post
const mostRecentProjectPost = nowPosts[0] || null; // This ensures there is a fallback if no posts are found
---

<Card
  colSpan="md:col-span-1"
  rowSpan="md:row-span-3"
  title="Projects"
  href="/projects"
>
  <div class="group h-full flex flex-col justify-center">
    <div class="space-y-4">
      {
        mostRecentProjectPost ? (
          <a
            href={`/${mostRecentProjectPost.data.category}/${mostRecentProjectPost.slug || "#default"}`}
            target=""
            rel="noopener noreferrer"
            class="block group/link"
          >
            <div class="space-y-3">
              <div class="space-y-2">
                <h3 class="text-lg font-bold text-white group-hover/link:text-blue-400 transition-colors duration-300 leading-tight line-clamp-2">
                  {mostRecentProjectPost.data.title}
                </h3>
                <div class="w-12 h-0.5 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full"></div>
              </div>

              <p class="text-neutral-100/70 text-sm leading-relaxed line-clamp-3 group-hover/link:text-neutral-100/90 transition-colors duration-300">
                {mostRecentProjectPost.data.description}
              </p>

              <div class="flex items-center gap-2 text-xs text-neutral-100/50 group-hover/link:text-blue-400/70 transition-colors duration-300">
                <Icon name="ri:arrow-right-line" class="h-4 w-4 group-hover/link:translate-x-1 transition-transform duration-300" />
                <span>Read more</span>
              </div>
            </div>
          </a>
        ) : (
          <div class="text-center py-8">
            <Icon name="ri:folder-open-line" class="h-12 w-12 text-neutral-100/30 mx-auto mb-3" />
            <p class="text-neutral-100/50 text-sm">No recent projects yet</p>
          </div>
        )
      }
    </div>
  </div>
</Card>
